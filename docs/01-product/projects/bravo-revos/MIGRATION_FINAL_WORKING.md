# ✅ FINAL WORKING DM Sequences Migrations (Use THESE Links!)

**IMPORTANT: These are the MINIMAL versions that don't touch shared infrastructure!**

## Migration 1: dm_sequences table

**[→ CLICK THIS ONE - Minimal dm_sequences (WORKING VERSION)](https://supabase.com/dashboard/project/kvjcidxbyimoswntpjcp/sql/new?content=LS0gTWlncmF0aW9uOiBDcmVhdGUgRE0gU2VxdWVuY2VzIFRhYmxlIChNSU5JTUFMIFZFUlNJT04pCi0tIFByb2plY3Q6IEJyYXZvIHJldk9TIC0gTGlua2VkSW4gTGVhZCBHZW5lcmF0aW9uCi0tIFB1cnBvc2U6IFN0b3JlIGF1dG9tYXRlZCBETSBzZXF1ZW5jZSBjb25maWd1cmF0aW9ucyBmb3IgY2FtcGFpZ25zCi0tIE5PVEU6IEFzc3VtZXMgdXVpZC1vc3NwIGV4dGVuc2lvbiBhbmQgdXBkYXRlX3VwZGF0ZWRfYXRfY29sdW1uKCkgZnVuY3Rpb24gYWxyZWFkeSBleGlzdAoKLS0gRE0gU2VxdWVuY2VzIFRhYmxlCkNSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGRtX3NlcXVlbmNlcyAoCiAgaWQgVVVJRCBQUklNQVJZIEtFWSBERUZBVUxUIHV1aWRfZ2VuZXJhdGVfdjQoKSwKICBjYW1wYWlnbl9pZCBVVUlEIE5PVCBOVUxMIFJFRkVSRU5DRVMgY2FtcGFpZ25zKGlkKSBPTiBERUxFVEUgQ0FTQ0FERSwKICBjbGllbnRfaWQgVVVJRCBOT1QgTlVMTCBSRUZFUkVOQ0VTIGNsaWVudHMoaWQpIE9OIERFTEVURSBDQVNDQURFLAoKICAtLSBNZXRhZGF0YQogIG5hbWUgVkFSQ0hBUigyNTUpIE5PVCBOVUxMLAogIGRlc2NyaXB0aW9uIFRFWFQsCiAgc3RhdHVzIFZBUkNIQVIoNTApIE5PVCBOVUxMIERFRkFVTFQgJ2FjdGl2ZScsIC0tIGFjdGl2ZSwgcGF1c2VkLCBhcmNoaXZlZAoKICAtLSBTdGVwIDE6IEluaXRpYWwgRE0KICBzdGVwMV90ZW1wbGF0ZSBURVhUIE5PVCBOVUxMLAogIHN0ZXAxX2RlbGF5X21pbiBJTlRFR0VSIE5PVCBOVUxMIERFRkFVTFQgMiwgLS0gbWludXRlcwogIHN0ZXAxX2RlbGF5X21heCBJTlRFR0VSIE5PVCBOVUxMIERFRkFVTFQgMTUsIC0tIG1pbnV0ZXMKICB2b2ljZV9jYXJ0cmlkZ2VfaWQgVVVJRCBSRUZFUkVOQ0VTIGNhcnRyaWRnZXMoaWQpLAoKICAtLSBTdGVwIDI6IEVtYWlsIGNhcHR1cmUKICBzdGVwMl9hdXRvX2V4dHJhY3QgQk9PTEVBTiBOT1QgTlVMTCBERUZBVUxUIHRydWUsCiAgc3RlcDJfY29uZmlybWF0aW9uX3RlbXBsYXRlIFRFWFQgTk9UIE5VTEwgREVGQVVMVCAnR290IGl0ISBTZW5kaW5nIHlvdXIgbGVhZCBtYWduZXQgbm93Li4uJywKCiAgLS0gU3RlcCAzOiBCYWNrdXAgRE0KICBzdGVwM19lbmFibGVkIEJPT0xFQU4gTk9UIE5VTEwgREVGQVVMVCB0cnVlLAogIHN0ZXAzX2RlbGF5IElOVEVHRVIgTk9UIE5VTEwgREVGQVVMVCA1LCAtLSBtaW51dGVzCiAgc3RlcDNfdGVtcGxhdGUgVEVYVCBOT1QgTlVMTCBERUZBVUxUICdIZXJlJydzIHlvdXIgZGlyZWN0IGRvd25sb2FkIGxpbms6IHt7ZG93bmxvYWRfdXJsfX0nLAogIHN0ZXAzX2xpbmtfZXhwaXJ5IElOVEVHRVIgTk9UIE5VTEwgREVGQVVMVCAyNCwgLS0gaG91cnMKCiAgLS0gQW5hbHl0aWNzCiAgc2VudF9jb3VudCBJTlRFR0VSIE5PVCBOVUxMIERFRkFVTFQgMCwKICByZXBsaWVkX2NvdW50IElOVEVHRVIgTk9UIE5VTEwgREVGQVVMVCAwLAogIGVtYWlsX2NhcHR1cmVkX2NvdW50IElOVEVHRVIgTk9UIE5VTEwgREVGQVVMVCAwLAoKICBjcmVhdGVkX2F0IFRJTUVTVEFNUCBXSVRIIFRJTUUgWk9ORSBOT1QgTlVMTCBERUZBVUxUIE5PVygpLAogIHVwZGF0ZWRfYXQgVElNRVNUQU1QIFdJVEggVElNRSBaT05FIE5PVCBOVUxMIERFRkFVTFQgTk9XKCkKKTsKCi0tIEluZGV4ZXMgKG9ubHkgaWYgdGhleSBkb24ndCBleGlzdCkKRE8gJCQKQkVHSU4KICBJRiBOT1QgRVhJU1RTIChTRUxFQ1QgMSBGUk9NIHBnX2luZGV4ZXMgV0hFUkUgaW5kZXhuYW1lID0gJ2lkeF9kbV9zZXF1ZW5jZXNfY2FtcGFpZ24nKSBUSEVOCiAgICBDUkVBVEUgSU5ERVggaWR4X2RtX3NlcXVlbmNlc19jYW1wYWlnbiBPTiBkbV9zZXF1ZW5jZXMoY2FtcGFpZ25faWQpOwogIEVORCBJRjsKCiAgSUYgTk9UIEVYSVNUUyAoU0VMRUNUIDEgRlJPTSBwZ19pbmRleGVzIFdIRVJFIGluZGV4bmFtZSA9ICdpZHhfZG1fc2VxdWVuY2VzX2NsaWVudCcpIFRIRU4KICAgIENSRUFURSBJTkRFWCBpZHhfZG1fc2VxdWVuY2VzX2NsaWVudCBPTiBkbV9zZXF1ZW5jZXMoY2xpZW50X2lkKTsKICBFTkQgSUY7CgogIElGIE5PVCBFWElTVFMgKFNFTEVDVCAxIEZST00gcGdfaW5kZXhlcyBXSEVSRSBpbmRleG5hbWUgPSAnaWR4X2RtX3NlcXVlbmNlc19zdGF0dXMnKSBUSEVOCiAgICBDUkVBVEUgSU5ERVggaWR4X2RtX3NlcXVlbmNlc19zdGF0dXMgT04gZG1fc2VxdWVuY2VzKHN0YXR1cyk7CiAgRU5EIElGOwpFTkQgJCQ7CgotLSBSTFMgUG9saWNpZXMKQUxURVIgVEFCTEUgZG1fc2VxdWVuY2VzIEVOQUJMRSBST1cgTEVWRUwgU0VDVVJJVFk7CgpETyAkJApCRUdJTgogIElGIE5PVCBFWElTVFMgKAogICAgU0VMRUNUIDEgRlJPTSBwZ19wb2xpY2llcwogICAgV0hFUkUgdGFibGVuYW1lID0gJ2RtX3NlcXVlbmNlcycKICAgIEFORCBwb2xpY3luYW1lID0gJ2RtX3NlcXVlbmNlc19jbGllbnRfaXNvbGF0aW9uJwogICkgVEhFTgogICAgQ1JFQVRFIFBPTElDWSBkbV9zZXF1ZW5jZXNfY2xpZW50X2lzb2xhdGlvbiBPTiBkbV9zZXF1ZW5jZXMKICAgICAgRk9SIEFMTAogICAgICBVU0lORyAoY2xpZW50X2lkID0gKFNFTEVDVCBjbGllbnRfaWQgRlJPTSB1c2VycyBXSEVSRSBpZCA9IGF1dGgudWlkKCkpKTsKICBFTkQgSUY7CkVORCAkJDsKCi0tIFVwZGF0ZWRfYXQgdHJpZ2dlciAoZHJvcCBhbmQgcmVjcmVhdGUgdG8gYmUgc2FmZSkKRFJPUCBUUklHR0VSIElGIEVYSVNUUyBkbV9zZXF1ZW5jZXNfdXBkYXRlZF9hdCBPTiBkbV9zZXF1ZW5jZXM7CkNSRUFURSBUUklHR0VSIGRtX3NlcXVlbmNlc191cGRhdGVkX2F0CiAgQkVGT1JFIFVQREFURSBPTiBkbV9zZXF1ZW5jZXMKICBGT1IgRUFDSCBST1cKICBFWEVDVVRFIEZVTkNUSU9OIHVwZGF0ZV91cGRhdGVkX2F0X2NvbHVtbigpOwo=)**

---

## Migration 2: dm_deliveries table

**[→ CLICK THIS ONE - Minimal dm_deliveries (WORKING VERSION)](https://supabase.com/dashboard/project/kvjcidxbyimoswntpjcp/sql/new?content=LS0gTWlncmF0aW9uOiBDcmVhdGUgRE0gRGVsaXZlcmllcyBUYWJsZSAoTUlOSU1BTCBWRVJTSU9OKQotLSBQcm9qZWN0OiBCcmF2byByZXZPUyAtIExpbmtlZEluIExlYWQgR2VuZXJhdGlvbgotLSBQdXJwb3NlOiBUcmFjayBpbmRpdmlkdWFsIERNIHNlbmRzIGFuZCBkZWxpdmVyeSBzdGF0dXMKLS0gTk9URTogQXNzdW1lcyB1dWlkLW9zc3AgZXh0ZW5zaW9uIGFuZCB1cGRhdGVfdXBkYXRlZF9hdF9jb2x1bW4oKSBmdW5jdGlvbiBhbHJlYWR5IGV4aXN0CgotLSBETSBEZWxpdmVyaWVzIFRhYmxlICh0cmFja2luZyBpbmRpdmlkdWFsIHNlbmRzKQpDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBkbV9kZWxpdmVyaWVzICgKICBpZCBVVUlEIFBSSU1BUlkgS0VZIERFRkFVTFQgdXVpZF9nZW5lcmF0ZV92NCgpLAogIHNlcXVlbmNlX2lkIFVVSUQgTk9UIE5VTEwgUkVGRVJFTkNFUyBkbV9zZXF1ZW5jZXMoaWQpIE9OIERFTEVURSBDQVNDQURFLAogIGxlYWRfaWQgVVVJRCBOT1QgTlVMTCBSRUZFUkVOQ0VTIGxlYWRzKGlkKSBPTiBERUxFVEUgQ0FTQ0FERSwKCiAgLS0gRGVsaXZlcnkgdHJhY2tpbmcKICBzdGVwX251bWJlciBJTlRFR0VSIE5PVCBOVUxMIENIRUNLIChzdGVwX251bWJlciBJTiAoMSwgMiwgMykpLAogIHN0YXR1cyBWQVJDSEFSKDUwKSBOT1QgTlVMTCBERUZBVUxUICdwZW5kaW5nJywgLS0gcGVuZGluZywgc2VudCwgZGVsaXZlcmVkLCBmYWlsZWQKICBzZW50X2F0IFRJTUVTVEFNUCBXSVRIIFRJTUUgWk9ORSwKICBkZWxpdmVyZWRfYXQgVElNRVNUQU1QIFdJVEggVElNRSBaT05FLAogIHJlcGxpZWRfYXQgVElNRVNUQU1QIFdJVEggVElNRSBaT05FLAoKICAtLSBDb250ZW50CiAgbWVzc2FnZV9jb250ZW50IFRFWFQgTk9UIE5VTEwsCiAgdW5pcGlsZV9tZXNzYWdlX2lkIFZBUkNIQVIoMjU1KSwgLS0gRXh0ZXJuYWwgSUQgZnJvbSBVbmlwaWxlCgogIC0tIEVtYWlsIGV4dHJhY3Rpb24gKHN0ZXAgMikKICBlbWFpbF9leHRyYWN0ZWQgVkFSQ0hBUigyNTUpLAogIGV4dHJhY3Rpb25fY29uZmlkZW5jZSBGTE9BVCwKICBleHRyYWN0aW9uX21ldGhvZCBWQVJDSEFSKDUwKSwgLS0gcmVnZXgsIGdwdDRvLCBtYW51YWwKCiAgLS0gRXJyb3JzCiAgZXJyb3JfbWVzc2FnZSBURVhULAogIHJldHJ5X2NvdW50IElOVEVHRVIgTk9UIE5VTEwgREVGQVVMVCAwLAogIGxhc3RfcmV0cnlfYXQgVElNRVNUQU1QIFdJVEggVElNRSBaT05FLAoKICBjcmVhdGVkX2F0IFRJTUVTVEFNUCBXSVRIIFRJTUUgWk9ORSBOT1QgTlVMTCBERUZBVUxUIE5PVygpLAogIHVwZGF0ZWRfYXQgVElNRVNUQU1QIFdJVEggVElNRSBaT05FIE5PVCBOVUxMIERFRkFVTFQgTk9XKCkKKTsKCi0tIEluZGV4ZXMgKG9ubHkgaWYgdGhleSBkb24ndCBleGlzdCkKRE8gJCQKQkVHSU4KICBJRiBOT1QgRVhJU1RTIChTRUxFQ1QgMSBGUk9NIHBnX2luZGV4ZXMgV0hFUkUgaW5kZXhuYW1lID0gJ2lkeF9kbV9kZWxpdmVyaWVzX3NlcXVlbmNlJykgVEhFTgogICAgQ1JFQVRFIElOREVYIGlkeF9kbV9kZWxpdmVyaWVzX3NlcXVlbmNlIE9OIGRtX2RlbGl2ZXJpZXMoc2VxdWVuY2VfaWQpOwogIEVORCBJRjsKCiAgSUYgTk9UIEVYSVNUUyAoU0VMRUNUIDEgRlJPTSBwZ19pbmRleGVzIFdIRVJFIGluZGV4bmFtZSA9ICdpZHhfZG1fZGVsaXZlcmllc19sZWFkJykgVEhFTgogICAgQ1JFQVRFIElOREVYIGlkeF9kbV9kZWxpdmVyaWVzX2xlYWQgT04gZG1fZGVsaXZlcmllcyhsZWFkX2lkKTsKICBFTkQgSUY7CgogIElGIE5PVCBFWElTVFMgKFNFTEVDVCAxIEZST00gcGdfaW5kZXhlcyBXSEVSRSBpbmRleG5hbWUgPSAnaWR4X2RtX2RlbGl2ZXJpZXNfc3RhdHVzJykgVEhFTgogICAgQ1JFQVRFIElOREVYIGlkeF9kbV9kZWxpdmVyaWVzX3N0YXR1cyBPTiBkbV9kZWxpdmVyaWVzKHN0YXR1cyk7CiAgRU5EIElGOwoKICBJRiBOT1QgRVhJU1RTIChTRUxFQ1QgMSBGUk9NIHBnX2luZGV4ZXMgV0hFUkUgaW5kZXhuYW1lID0gJ2lkeF9kbV9kZWxpdmVyaWVzX3N0ZXAnKSBUSEVOCiAgICBDUkVBVEUgSU5ERVggaWR4X2RtX2RlbGl2ZXJpZXNfc3RlcCBPTiBkbV9kZWxpdmVyaWVzKHN0ZXBfbnVtYmVyKTsKICBFTkQgSUY7CgogIElGIE5PVCBFWElTVFMgKFNFTEVDVCAxIEZST00gcGdfaW5kZXhlcyBXSEVSRSBpbmRleG5hbWUgPSAnaWR4X2RtX2RlbGl2ZXJpZXNfc2VudF9hdCcpIFRIRU4KICAgIENSRUFURSBJTkRFWCBpZHhfZG1fZGVsaXZlcmllc19zZW50X2F0IE9OIGRtX2RlbGl2ZXJpZXMoc2VudF9hdCk7CiAgRU5EIElGOwpFTkQgJCQ7CgotLSBSTFMgUG9saWNpZXMKQUxURVIgVEFCTEUgZG1fZGVsaXZlcmllcyBFTkFCTEUgUk9XIExFVkVMIFNFQ1VSSVRZOwoKRE8gJCQKQkVHSU4KICBJRiBOT1QgRVhJU1RTICgKICAgIFNFTEVDVCAxIEZST00gcGdfcG9saWNpZXMKICAgIFdIRVJFIHRhYmxlbmFtZSA9ICdkbV9kZWxpdmVyaWVzJwogICAgQU5EIHBvbGljeW5hbWUgPSAnZG1fZGVsaXZlcmllc19jbGllbnRfaXNvbGF0aW9uJwogICkgVEhFTgogICAgQ1JFQVRFIFBPTElDWSBkbV9kZWxpdmVyaWVzX2NsaWVudF9pc29sYXRpb24gT04gZG1fZGVsaXZlcmllcwogICAgICBGT1IgQUxMCiAgICAgIFVTSU5HICgKICAgICAgICBzZXF1ZW5jZV9pZCBJTiAoCiAgICAgICAgICBTRUxFQ1QgaWQgRlJPTSBkbV9zZXF1ZW5jZXMgV0hFUkUgY2xpZW50X2lkID0gKAogICAgICAgICAgICBTRUxFQ1QgY2xpZW50X2lkIEZST00gdXNlcnMgV0hFUkUgaWQgPSBhdXRoLnVpZCgpCiAgICAgICAgICApCiAgICAgICAgKQogICAgICApOwogIEVORCBJRjsKRU5EICQkOwoKLS0gVXBkYXRlZF9hdCB0cmlnZ2VyIChkcm9wIGFuZCByZWNyZWF0ZSB0byBiZSBzYWZlKQpEUk9QIFRSSUdHRVIgSUYgRVhJU1RTIGRtX2RlbGl2ZXJpZXNfdXBkYXRlZF9hdCBPTiBkbV9kZWxpdmVyaWVzOwpDUkVBVEUgVFJJR0dFUiBkbV9kZWxpdmVyaWVzX3VwZGF0ZWRfYXQKICBCRUZPUkUgVVBEQVRFIE9OIGRtX2RlbGl2ZXJpZXMKICBGT1IgRUFDSCBST1cKICBFWEVDVVRFIEZVTkNUSU9OIHVwZGF0ZV91cGRhdGVkX2F0X2NvbHVtbigpOwo=)**

---

## Key Differences (Why These Work)

**These MINIMAL migrations:**
- ❌ Do NOT touch `update_updated_at_column()` function (it already exists)
- ❌ Do NOT touch `uuid-ossp` extension (it already exists)
- ✅ Use `DO $$` blocks for idempotent index creation
- ✅ Use `DO $$` blocks for idempotent RLS policy creation
- ✅ Only create triggers on OUR new tables (dm_sequences, dm_deliveries)

**Result:** No conflicts with existing tables like scrape_jobs or notifications!
